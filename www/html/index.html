<!-- MAIN -->
<div class="main">
    <style>
        .ct-series-b .ct-point, .ct-series-b .ct-line, .ct-series-b .ct-bar, .ct-series-b .ct-slice-donut {
            stroke: #5cb85c;
        }

        .info-label span {
            display: inline-block;
            margin-left: 10px;
        }

        .info-label i {
            display: inline-block;
            width: 15px;
            height: 15px;
            margin-left: 10px;
            border-radius: 50%;
            position: relative;
            top: 2px;
        }

        .t-u-b {
            background-color: #028fd0;
        }

        .t-u-g {
            background-color: #5cb85c;
        }
    </style>
    <link rel="stylesheet" href="./assets/common/css/index.css">
    <!-- MAIN CONTENT -->
    <div class="main-content">
        <div class="container-fluid">
            <!-- OVERVIEW -->
            <div class="panel panel-headline">
                <div class="panel-heading">
                    <h3 class="panel-title">基本概览</h3>
                    <!--<p class="panel-subtitle">时间: 2018/08/1 - 2018/08/30</p>-->
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-3 index-user">
                            <div class="metric">
                                <span class="icon"><i class="lnr lnr-user"></i></span>
                                <p>
                                    <span class="number user-total">0</span>
                                    <span class="title">用户注册总数</span>
                                </p>
                            </div>
                        </div>
                        <div class="col-md-3 index-user">
                            <div class="metric">
                                <span class="icon"><i class="lnr lnr-user"></i></span>
                                <p>
                                    <span class="number user_register">0</span>
                                    <span class="title">用户注册数</span>
                                </p>
                            </div>
                        </div>
                        <div class="col-md-3 index-user">
                            <div class="metric">
                                <span class="icon"><i class="lnr lnr-heart"></i></span>
                                <p>
                                    <span class="number user_login">0</span>
                                    <span class="title">用户活跃数</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="data-times">
                            <div style="position: relative; margin-top: 6px; padding: 0 36px">
                                <div class="time-title">查看年（月）趋势</div>
                                <div class="time-y">
                                    <div class="time-y-c">年：<span class="time-y-val"></span></div>
                                    <!--<div class="time-if-checked">-->
                                    <!--<div class="icon-checkde" data-time="icon-y">-->
                                    <!--<img src="./assets/common/img/checked1.png" alt="">-->
                                    <!--<input type="checkbox" style="display: none">-->
                                    <!--</div>-->
                                    <!--</div>-->
                                </div>
                                /
                                <div class="time-m">
                                    <div class="time-m-c">月：<span class="time-m-val"></span></div>
                                    <div class="time-if-checked">
                                        <div class="icon-checkde" data-time="icon-m">
                                            <img src="./assets/common/img/checked1.png" alt="">
                                            <input type="checkbox" style="display: none">
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" value="1" class="time-sort">
                                <div class="time-btn-checked"><a href="javascript:void(0)">查询</a></div>
                                <div class="time-btn-reset"><a href="javascript:void(0)">重置</a></div>

                                <div class="time-right">
                                    <button type="button" class="time-btn-toggle">
                                        <i class="lnr lnr-chevron-up"></i>
                                    </button>
                                    <!--<button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button>-->
                                </div>
                            </div>
                            <div class="time-lists">
                                <div class="time-y-list"></div>
                                <div class="time-m-list"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-9" style="position: relative">
                            <div id="headline-chart" class="ct-chart" style="height: 305px;"></div>
                            <div id="loading"
                                 style="width: 98%; position: absolute; text-align: center; top: 30%"></div>
                        </div>
                        <div class="col-md-3">
                            <div class="weekly-summary text-right" style="margin-bottom: 15px">
                                <span class="number user_reg"></span>
                                <span class="info-label">用户注册数</span>
                            </div>
                            <div class="weekly-summary text-right">
                                <span class="number user_log"></span>
                                <span class="info-label">用户活跃数</span>
                            </div>
                            <div class="weekly-summary text-right" style="margin-bottom: 0">
                                <span class="info-label">每周注册/活跃人数</span>
                            </div>
                            <div class="weekly-summary text-right">
                                <div class="info-label">第一周（人）：
                                    <i class="t-u-b"></i>
                                    <span class="t_z_user t-1-user1">0</span>
                                    <i class="t-u-g"></i>
                                    <span class="t_z_user t-1-user2">0</span>
                                </div>
                                <div class="info-label">第二周（人）：
                                    <i class="t-u-b"></i>
                                    <span class="t_z_user t-2-user1">0</span>
                                    <i class="t-u-g"></i>
                                    <span class="t_z_user t-2-user2">0</span>
                                </div>
                                <div class="info-label">第三周（人）：
                                    <i class="t-u-b"></i>
                                    <span class="t_z_user t-3-user1">0</span>
                                    <i class="t-u-g"></i>
                                    <span class="t_z_user t-3-user2">0</span>
                                </div>
                                <div class="info-label">最后（人）：
                                    <i class="t-u-b"></i>
                                    <span class="t_z_user t-4-user1">0</span>
                                    <i class="t-u-g"></i>
                                    <span class="t_z_user t-4-user2">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6" style="width: 100%">
                    <!-- RECENT PURCHASES -->
                    <div class="panel">
                        <div class="panel-heading">
                            <h3 class="panel-title">最近新增的用户</h3>
                            <div class="right">
                                <button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i>
                                </button>
                                <button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button>
                            </div>
                        </div>
                        <div class="panel-body no-padding">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>id</th>
                                    <th>昵称</th>
                                    <th>性别</th>
                                    <th>联系电话</th>
                                    <th>时间</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody class="indexULists">
                                <!--<tr>
                                    <td><a href="#">763648</a></td>
                                    <td>Steve</td>
                                    <td>$122</td>
                                    <td>Oct 21, 2016</td>
                                    <td><span class="label label-success">COMPLETED</span></td>
                                </tr>
                                <tr>
                                    <td><a href="#">763649</a></td>
                                    <td>Amber</td>
                                    <td>$62</td>
                                    <td>Oct 21, 2016</td>
                                    <td><span class="label label-warning">PENDING</span></td>
                                </tr>
                                <tr>
                                    <td><a href="#">763650</a></td>
                                    <td>Michael</td>
                                    <td>$34</td>
                                    <td>Oct 18, 2016</td>
                                    <td><span class="label label-danger">FAILED</span></td>
                                </tr>
                                <tr>
                                    <td><a href="#">763651</a></td>
                                    <td>Roger</td>
                                    <td>$186</td>
                                    <td>Oct 17, 2016</td>
                                    <td><span class="label label-success">SUCCESS</span></td>
                                </tr>
                                <tr>
                                    <td><a href="#">763652</a></td>
                                    <td>Smith</td>
                                    <td>$362</td>
                                    <td>Oct 16, 2016</td>
                                    <td><span class="label label-success">SUCCESS</span></td>
                                </tr>-->
                                </tbody>
                            </table>
                        </div>
                        <div id="loading-users"
                             style="width: 98%; position: absolute; text-align: center; top: 30%"></div>
                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-md-6">
                                    <span class="panel-note"><i class="fa fa-clock-o"></i> 最新注册的10位用户</span>
                                </div>
                                <div class="col-md-6 text-right">
                                    <a href="javascript:void(0);" data-href="/user/user-lists.html"
                                       class="btn btn-primary more-users">查看更多</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END RECENT PURCHASES -->
                </div>
                <!--<div class="col-md-6">-->
                <!--&lt;!&ndash; MULTI CHARTS &ndash;&gt;-->
                <!--<div class="panel">-->
                <!--<div class="panel-heading">-->
                <!--<h3 class="panel-title">Projection vs. Realization</h3>-->
                <!--<div class="right">-->
                <!--<button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i>-->
                <!--</button>-->
                <!--<button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button>-->
                <!--</div>-->
                <!--</div>-->
                <!--<div class="panel-body">-->
                <!--<div id="visits-trends-chart" class="ct-chart"></div>-->
                <!--</div>-->
                <!--</div>-->
                <!--&lt;!&ndash; END MULTI CHARTS &ndash;&gt;-->
                <!--</div>-->
            </div>
            <!-- END OVERVIEW -->
        </div>
    </div>
</div>
<!-- END MAIN CONTENT -->
</div>
<!-- END MAIN -->
<div class="clearfix"></div>
<footer>
    <div class="container-fluid">
        <!--<p class="copyright">Copyright &copy; 2017.Company name All rights reserved.More Templates-->
        <!--<a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from-->
        <!--<a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a>-->
        <!--</p>-->
    </div>
</footer>
<script>
    $(function () {
        var getYear = myDate.getFullYear();
        var getMonth = Number(myDate.getMonth()) + 1;//因为从0开始，所以要+1
        var years = [2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025, 2026]
        var month = ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"]
        //year
        var div_y = "<ul>"
        for (var i in years) {
            var active = ""
            if (years[i] == getYear) {
                console.log(years[i])
                active = "time-active"
            }
            div_y += "<li><a href='javascript:void(0)' data-year='" + years[i] + "' class='" + active + " y-" + years[i] + "'>" + years[i] + "</a></li>"
        }
        div_y += "<ul>"

        //month
        var div_m = "<ul>"
        for (var i2 in month) {
            var active = ""
            if (month[i2] == getMonth) {
                console.log(month[i2])
                active = "time-active"
            }
            div_m += "<li><a href='javascript:void(0)' data-month='" + month[i2] + "' class='" + active + " lock m-" + month[i2] + "'>" + month[i2] + "</a></li>"
        }
        div_m += "<ul>"

        $(".time-y-list").append(div_y)
        $(".time-m-list").append(div_m)

        var c1 = "./assets/common/img/checked1.png";
        var c2 = "./assets/common/img/checked2.png";
        $(".icon-checkde").on("click", function () {
            var check = $(this).find("input[type='checkbox']").is(':checked');
            var icon_data = $(this).attr("data-time");
            console.log(check)
            var ym = icon_data.substr(5)
            if (!check) {
                $(this).find("img").attr("src", c2)
                $(this).find("input[type='checkbox']").prop("checked", 'true');
                // if (icon_data == "icon-m") {
                //     $(".icon-checkde").find("img").attr("src", c2)
                //     $(".icon-checkde").find("input[type='checkbox']").prop("checked", 'true');
                //     $(".time-y-list li a").removeClass("lock")
                //     $(".time-m-list li a").removeClass("lock")
                // }
                $(".time-sort").val(1)
                $(".time-" + ym + "-list li a").removeClass("lock")
            } else {
                $(this).find("img").attr("src", c1)
                $(this).find("input[type='checkbox']").removeAttr("checked");
                // if (icon_data == "icon-y") {
                //     $(".icon-checkde").find("img").attr("src", c1)
                //     $(".icon-checkde").find("input[type='checkbox']").removeAttr("checked");
                //     $(".time-y-list li a").addClass("lock")
                //     $(".time-m-list li a").addClass("lock")
                // }
                $(".time-m-val").text("");
                $(".time-sort").val(2)
                $(".time-m-list li").find("a").removeClass("time-active")
                $(".time-" + ym + "-list li a").addClass("lock")
            }
        })

    })
</script>
<script>
    $(function () {
        var data, options;
        var labels = [];
        var day = getCountDays();
        for (var i = 1; i <= day; i++) {
            if (i > day) break;
            labels.push(i)
        }

        startAjax();

        function startAjax() {
            var url = config.data + "users/getUserNum";
            var getYear = myDate.getFullYear();
            var getMonth = Number(myDate.getMonth()) + 1;//因为从0开始，所以要+1
            var getDate = getYear + "-0" + getMonth;//yyyy-MM如：2018-08
            var count = {
                sort: 1,
                last_time: getDate
            };

            $(".time-y-val").text(getYear);
            $(".time-m-val").text("0" + getMonth);

            $.ajax({
                type: "get",
                url: url,
                data: count,
                beforeSend: function (XMLHttpRequest) {
                    //alert('远程调用开始...');
                    $("#loading").html("<img src='./assets/common/img/loading.gif' />");
                },
                success: function (msg) {
                    console.log(msg)
                    $(".number.user_register").text(msg.gnum)
                    $(".t-1-user1").text(msg.fnum);
                    $(".t-2-user1").text(msg.snum);
                    $(".t-3-user1").text(msg.tnum);
                    $(".t-4-user1").text(msg.fournum);
                    var arr = msg.userNum
                    $.ajax({
                        type: "get",
                        url: config.data + "users/getLoginNum",
                        data: count,
                        success: function (msg2) {
                            console.log(msg2)
                            $(".number.user_login").text(msg2.gnum)
                            $(".t-1-user2").text(msg2.fnum);
                            $(".t-2-user2").text(msg2.snum);
                            $(".t-3-user2").text(msg2.tnum);
                            $(".t-4-user2").text(msg2.fournum);
                            var arr2 = msg2.loginNum
                            data = {
                                labels: labels,
                                series: [
                                    arr,
                                    arr2,
                                ]
                            };

                            options = {
                                height: 300,
                                // showArea: true,
                                // showLine: false,
                                // showPoint: false,
                                fullWidth: true,
                                axisX: {
                                    showGrid: false
                                },
                                lineSmooth: false,
                            };

                            new Chartist.Line('#headline-chart', data, options);
                        },
                    })
                },
                complete: function (XMLHttpRequest, textStatus) {
                    // alert('远程调用成功，状态文本值：'+textStatus);
                    $("#loading").empty();
                }
            });
        }

        var userUrl = config.data + "users/getUserList";
        $.ajax({
            type: "get",
            url: userUrl,
            data: {p: 1},
            timeout: 15000,
            beforeSend: function (XMLHttpRequest) {
                //alert('远程调用开始...');
                $("#loading").html("<img src='./assets/common/img/loading.gif' />");
            },
            success: function (msg) {
                $(".user-total").text(msg.totalUser)
                var users = msg.result;
                var html = ""
                for (var i in users) {
                    var sortNum = Number(i) + 1;
                    html += "<tr>";
                    html += "<td>" + sortNum + "</td>";
                    html += "<td>" + users[i].id + "</td>";
                    html += "<td>" + users[i].nick_name + "</td>";
                    if (users[i].sex == 1) {
                        html += "<td>男</td>";
                    } else if (users[i].sex == 2) {
                        html += "<td>女</td>";
                    } else {
                        html += "<td>保密</td>";
                    }
                    html += "<td>" + users[i].tel + "</td>";
                    html += "<td>注册：" + users[i].time_logon + "<br>上次登录：" + users[i].login_time + "</td>";
                    html += "<td>--/--</td>";
                    html += "</tr>";
                }
                html += "<input type='hidden' id='url' value='" + userUrl + "'/>"
                $(".indexULists").append(html);
            },
            // complete: function (XMLHttpRequest, textStatus) {
            //     // alert('远程调用成功，状态文本值：'+textStatus);
            //     $("#loading").empty();
            // }
        });

        $(".time-y-list li").on("click", function () {
            var this_year = $(this).find("a").attr("data-year")
            $(".time-y-list li").find("a").removeClass("time-active")
            $(this).find("a").addClass("time-active")

            $(".time-y-val").text(this_year);
        })
        $(".time-m-list li").on("click", function () {
            var isLock = $(".time-m-list li").find("a").is('.lock')
            if (isLock) {
                layer.msg("当前月份不可选");
                return false;
            }
            var this_month = $(this).find("a").attr("data-month")
            $(".time-m-list li").find("a").removeClass("time-active")
            $(this).find("a").addClass("time-active")

            $(".time-m-val").text(this_month);
        })


        $(".time-btn-checked a").on("click", function () {
            var sort = $(".time-sort").val();
            var year = $(".time-y-val").text();
            var month = $(".time-m-val").text();
            var dataTime = year + "-" + month
            if (sort == 1) {
                if (!month) {
                    layer.msg("请选择查看的月份");
                    return false;
                }
            } else {
                dataTime = year;
                if (month) {
                    layer.msg("当前只查年度");
                    return false
                }
            }
            var dataArr = {
                last_time: dataTime,
                sort: sort
            }
            $.ajax({
                type: "get",
                url: config.data + "users/getUserNum",
                data: dataArr,
                beforeSend: function (XMLHttpRequest) {
                    //alert('远程调用开始...');
                    $("#loading").html("<img src='./assets/common/img/loading.gif' />");
                },
                success: function (msg) {
                    var arr = msg.userNum
                    $(".number.user_register").text(msg.gnum)
                    $(".t-1-user1").text(msg.fnum);
                    $(".t-2-user1").text(msg.snum);
                    $(".t-3-user1").text(msg.tnum);
                    $(".t-4-user1").text(msg.fournum);
                    $.ajax({
                        type: "get",
                        url: config.data + "users/getLoginNum",
                        data: dataArr,
                        success: function (msg2) {
                            var arr2 = msg2.loginNum
                            $(".number.user_login").text(msg2.gnum)
                            $(".t-1-user2").text(msg2.fnum);
                            $(".t-2-user2").text(msg2.snum);
                            $(".t-3-user2").text(msg2.tnum);
                            $(".t-4-user2").text(msg2.fournum);
                            if (sort == 2) {
                                TrendMap(arr, arr2, sort)
                            } else {
                                TrendMap(arr, arr2, sort, parseInt(month))
                            }
                        }
                    })
                },
                complete: function (XMLHttpRequest, textStatus) {
                    // alert('远程调用成功，状态文本值：'+textStatus);
                    $("#loading").empty();
                }
            })

        })

        function TrendMap(arr, arr2, sort, momth = 0) {
            var labels = []
            if (sort == 2) {
                labels = ['1', '2', '3', '2', '5', '6', '7', '8', '9', '10', '11', '12']
            } else {
                var day = getCountDays(momth);
                for (var i = 1; i <= day; i++) {
                    if (i > day) break;
                    labels.push(i)
                }
            }
            data = {
                labels: labels,
                series: [
                    arr,
                    arr2,
                ]
            };

            options = {
                height: 300,
                // showArea: true,
                // showLine: false,
                // showPoint: false,
                fullWidth: true,
                axisX: {
                    showGrid: false
                },
                lineSmooth: false,
            };

            new Chartist.Line('#headline-chart', data, options);
        }

        $(".more-users").click(function () {
            $(".nav li").find("a").removeClass("active");
            $(".users").addClass("active");
            var href = $(".users").attr("data-href");
            $.ajax({
                url: "./" + href,
                type: "GET",
                dataType: "html",
                success: function (result) {
                    $("#wrapper .main").remove();
                    $("#wrapper").append(result);
                    // alert($("#sidebar-nav").html())
                }
            });
        })
        $(".time-btn-reset").click(function () {
            var getYear = myDate.getFullYear();
            var getMonth = Number(myDate.getMonth()) + 1;
            var c1 = "./assets/common/img/checked1.png";

            $(".time-m-list li a").addClass("lock")
            $(".time-y-list li a").removeClass("time-active")
            $(".time-m-list li a").removeClass("time-active")

            $(".time-y-list li a.y-" + getYear).addClass("time-active")
            $(".time-m-list li a.m-0" + getMonth).addClass("time-active")
            $(".time-y-val").text(getYear)
            $(".time-m-val").text("0" + getMonth)

            $(".icon-checkde img").attr("src", c1)
            $(".icon-checkde input[type=checkbox]").removeAttr("checked")
            $(".time-sort").val(1);

            startAjax()
        })
    });
</script>
</div>
<!-- END WRAPPER -->
</body>

</html>
